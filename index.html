<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Basic meta -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MapMyWeather ‚Äî Global Interactive Weather Map | Live Forecasts & Radar</title>
  <meta name="description" content="Free interactive world weather map with live forecasts. Check temperature, wind, rain, and humidity for any city worldwide. Real-time weather data from WeatherAPI.">
  <meta name="keywords" content="weather, weather map, live weather, world weather, temperature, forecast, wind, rain, humidity, weather radar, global weather, local weather, weather today, weather forecast, weather API">

  <!-- Canonical (important if same content appears elsewhere) -->
  <link rel="canonical" href="https://map-my-weather.netlify.app/">

  <!-- Favicon / icons -->
  <link rel="icon" href="/favicon.png" type="image/png" sizes="512x512">
  <link rel="shortcut icon" href="/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/favicon.png">

  <!-- Manifest (optional but good for PWA / mobile shortcuts) -->
  <link rel="manifest" href="/site.webmanifest">

  <!-- Social (Open Graph) -->
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="MapMyWeather ‚Äî Global Interactive Weather Map | Live Forecasts" />
  <meta property="og:description" content="Free interactive world weather map with live forecasts, temperature, wind, rain and humidity data for any location worldwide." />
  <meta property="og:url" content="https://map-my-weather.netlify.app/" />
  <meta property="og:site_name" content="MapMyWeather" />
  <meta property="og:image" content="https://map-my-weather.netlify.app/og-image.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="MapMyWeather ‚Äî Global Interactive Weather Map">
  <meta name="twitter:description" content="Free interactive world weather map with live forecasts, temperature, wind, and rain data.">
  <meta name="twitter:image" content="https://map-my-weather.netlify.app/og-image.png">

  <!-- Robots -->
  <meta name="robots" content="index, follow, max-image-preview:large">

  <!-- Additional SEO Meta -->
  <meta name="author" content="MapMyWeather">
  <meta name="theme-color" content="#4a90e2">
  <meta name="subject" content="Weather forecasts and maps">
  <meta name="rating" content="General">
  <meta name="revisit-after" content="1 day">
  
  <!-- Geo and Location Meta -->
  <meta name="geo.region" content="Global">
  <meta name="geo.placename" content="Worldwide">

  <!-- Structured data (JSON-LD) - Enhanced for Weather Service -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "Organization",
        "@id": "https://map-my-weather.netlify.app/#organization",
        "name": "MapMyWeather",
        "url": "https://map-my-weather.netlify.app/",
        "logo": "https://map-my-weather.netlify.app/favicon.png",
        "description": "Interactive global weather map providing live forecasts and weather data",
        "sameAs": []
      },
      {
        "@type": "WebSite",
        "@id": "https://map-my-weather.netlify.app/#website",
        "url": "https://map-my-weather.netlify.app/",
        "name": "MapMyWeather",
        "description": "Interactive global weather map with live forecasts, temperature, wind and rain overlays.",
        "publisher": { "@id": "https://map-my-weather.netlify.app/#organization" },
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://map-my-weather.netlify.app/?s={search_term_string}",
          "query-input": "required name=search_term_string"
        }
      },
      {
        "@type": "Service",
        "name": "Weather Forecast Service",
        "description": "Real-time weather forecasts and interactive weather maps for locations worldwide",
        "provider": { "@id": "https://map-my-weather.netlify.app/#organization" },
        "areaServed": "Worldwide",
        "serviceType": "Weather Forecasting"
      }
    ]
  }
  </script>

</head>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />

  <style>
    :root {
      --primary: #4a90e2;
      --primary-dark: #357ABD;
      --secondary: #ff7043;
      --secondary-dark: #e64a19;
      --accent: #f0ad4e;
      --accent-dark: #ec971f;
      --danger: #d9534f;
      --danger-dark: #c9302c;
      --light: #f8f9fa;
      --dark: #343a40;
      --gray: #6c757d;
      --success: #28a745;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
      color: var(--dark);
      line-height: 1.6;
    }

    header {
      padding: 1.5rem 2rem;
      background: rgba(255, 255, 255, 0.95);
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      backdrop-filter: blur(10px);
    }

    header h1 {
      margin: 0;
      font-size: 2.2rem;
      flex-basis: 100%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
    }

    header p {
      margin: 0 0 1rem 0;
      font-size: 1.1rem;
      flex-basis: 100%;
      color: var(--gray);
    }

    #searchForm {
      max-width: 500px;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      flex-grow: 1;
      min-width: 260px;
    }

    #searchInput {
      flex-grow: 1;
      padding: 0.75rem 1.2rem;
      border: 2px solid transparent;
      border-radius: 30px;
      font-size: 1rem;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      min-width: 150px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
    }

    #searchInput:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 3px 15px rgba(74, 144, 226, 0.3);
    }

    #searchButton {
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: none;
      border-radius: 30px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 100px;
      box-shadow: 0 3px 10px rgba(74, 144, 226, 0.3);
    }

    #searchButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
    }

    #gameButton {
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
      border: none;
      border-radius: 30px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 180px;
      box-shadow: 0 3px 10px rgba(255, 112, 67, 0.3);
    }

    #gameButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 112, 67, 0.4);
    }

    #settingsBtn {
      padding: 0.6rem 1.2rem;
      background: linear-gradient(135deg, var(--gray), #5a6268);
      border: none;
      border-radius: 30px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
      box-shadow: 0 3px 10px rgba(108, 117, 125, 0.3);
    }
    #settingsBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
    }

    #settingsModal {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 1.5rem 2rem;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      z-index: 10000;
      min-width: 300px;
      text-align: center;
      backdrop-filter: blur(10px);
    }
    #settingsModal.show {
      display: block;
    }
    #settingsModal label {
      font-weight: bold;
      margin-bottom: 0.8rem;
      display: block;
      color: var(--dark);
      font-size: 1.1rem;
    }
    #settingsModal select {
      width: 100%;
      padding: 0.7rem;
      font-size: 1rem;
      border-radius: 10px;
      border: 2px solid #e9ecef;
      margin-bottom: 1.2rem;
      transition: border-color 0.3s;
    }
    #settingsModal select:focus {
      outline: none;
      border-color: var(--primary);
    }
    #settingsModal button {
      padding: 0.7rem 1.5rem;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(74, 144, 226, 0.3);
    }
    #settingsModal button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
    }

    main {
      max-width: 1200px;
      margin: 1.5rem auto;
      padding: 0 1.5rem;
    }

    #map {
      height: 500px;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      overflow: hidden;
      margin-bottom: 2rem;
      position: relative;
    }

    /* City weather section */
    #citiesWeatherSection {
      margin-top: 1.5rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }

    #citiesWeatherSection h2 {
      margin-top: 0;
      color: var(--dark);
      border-bottom: 2px solid var(--primary);
      padding-bottom: 0.5rem;
    }

    #citiesWeatherContainer {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: center;
    }

    /* Favorite section right below map */
    #favoritesSection {
      margin-top: 1.5rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }

    #favoritesSection h2 {
      margin-top: 0;
      color: var(--dark);
      border-bottom: 2px solid var(--primary);
      padding-bottom: 0.5rem;
    }

    #addFavoriteForm {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    #addFavoriteInput {
      flex-grow: 1;
      padding: 0.7rem 1.2rem;
      border-radius: 30px;
      border: 2px solid #e9ecef;
      font-size: 1rem;
      min-width: 200px;
      transition: all 0.3s ease;
    }
    
    #addFavoriteInput:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 3px 15px rgba(240, 173, 78, 0.3);
    }

    #addFavoriteBtn {
      padding: 0.7rem 1.5rem;
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      border: none;
      border-radius: 30px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      min-width: 150px;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(240, 173, 78, 0.3);
    }

    #addFavoriteBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(240, 173, 78, 0.4);
    }

    #favoritesContainer {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: center;
    }

    .city-weather {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 1.2rem;
      width: 220px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
      border-top: 4px solid var(--primary);
      backdrop-filter: blur(5px);
    }

    .city-weather:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .city-weather h3 {
      margin-top: 0;
      color: var(--dark);
      font-size: 1.1rem;
    }

    .temp {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--primary);
      margin: 0.5rem 0;
    }

    .desc {
      font-style: italic;
      color: var(--gray);
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }
    
    .details {
      display: flex;
      justify-content: space-around;
      font-size: 0.8rem;
      color: var(--gray);
      margin-bottom: 0.5rem;
    }

    .remove-fav-btn {
      background: linear-gradient(135deg, var(--danger), var(--danger-dark));
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 14px;
      width: 26px;
      height: 26px;
      line-height: 26px;
      padding: 0;
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(217, 83, 79, 0.3);
    }
    .remove-fav-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 3px 8px rgba(217, 83, 79, 0.4);
    }

    #about {
      margin-top: 2.5rem;
      background: rgba(255, 255, 255, 0.95);
      padding: 1.8rem;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }
    
    #about h2 {
      color: var(--dark);
      border-bottom: 2px solid var(--primary);
      padding-bottom: 0.5rem;
    }

    footer {
      text-align: center;
      padding: 1.5rem;
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 2rem;
    }

    #feedbackBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 30px;
      font-weight: bold;
      cursor: pointer;
      font-size: 0.95rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      z-index: 9999;
      text-decoration: none;
    }

    #feedbackBtn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }

    /* Simple markers instead of banners */
    .weather-marker {
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid var(--primary);
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 0.8rem;
      font-weight: bold;
      color: var(--primary);
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    @media (max-width: 768px) {
      #citiesWeatherContainer,
      #favoritesContainer {
        flex-direction: column;
        align-items: center;
      }
      #searchForm {
        flex-direction: column;
        gap: 0.5rem;
      }
      #searchInput, #searchButton, #gameButton, #addFavoriteInput, #addFavoriteBtn, #settingsBtn {
        min-width: 100%;
        border-radius: 30px;
      }
      .city-weather {
        width: 100%;
        max-width: 280px;
      }
    }
  </style>
</head>
<body>

<header>
  <h1 id="title">MapMyWeather</h1>
  <p id="subtitle">Explore real-time weather worldwide or search any city below</p>
  <form id="searchForm">
    <input type="search" id="searchInput" placeholder="Search a city (e.g. London)" required />
    <button type="submit" id="searchButton">Search</button>
    <button type="button" id="gameButton" onclick="location.href='game.html'">üéÆ Play WeatherGuessr</button>
    <button type="button" id="settingsBtn">Settings ‚öôÔ∏è</button>
  </form>
</header>

<main>
  <div id="map"></div>

  <!-- New Cities Weather Section -->
  <section id="citiesWeatherSection">
    <h2 id="citiesWeatherTitle">Global Cities Weather</h2>
    <div id="citiesWeatherContainer">
      <!-- City weather cards will be rendered here -->
    </div>
  </section>

  <!-- Favorites Section -->
  <section id="favoritesSection">
    <h2 id="favoritesTitle">Your Favorite Locations</h2>
    <form id="addFavoriteForm">
      <input type="text" id="addFavoriteInput" placeholder="Add a city to favorites" required />
      <button type="submit" id="addFavoriteBtn">Add to Favorites</button>
    </form>
    <div id="favoritesContainer">
      <!-- Favorite cities weather cards will be rendered here -->
    </div>
  </section>

  <section id="about">
    <h2 id="aboutTitle">About MapMyWeather</h2>
    <p id="aboutText">
      MapMyWeather is an interactive world map showing current weather conditions for major global cities.
      Click on any marker to learn more about the weather there, or use the search bar to view a detailed forecast.
      This app is powered by <strong>WeatherAPI.com</strong> and is entirely free to use.
    </p>
  </section>
</main>

<footer>
  ¬© 2025 MapMyWeather | Built by Reuben | Data from WeatherAPI.com
</footer>

<!-- Feedback Button -->
<a id="feedbackBtn" href="https://docs.google.com/forms/d/1Sr-6EWcdBa7Hst9nyJLvTz7oU-eGozoYBpZTMKj7_mU/viewform" target="_blank">
  Help Us Improve
</a>

<!-- Settings Modal -->
<div id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsModalLabel">
  <label for="languageSelect" id="settingsModalLabel">Select Language</label>
  <select id="languageSelect" aria-describedby="settingsModalLabel">
    <option value="en">English</option>
    <option value="zh">‰∏≠Êñá (Chinese)</option>
    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
    <option value="es">Espa√±ol (Spanish)</option>
    <option value="fr">Fran√ßais (French)</option>
    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (Arabic)</option>
    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
    <option value="ru">–†—É—Å—Å–∫–∏–π (Russian)</option>
    <option value="pt">Portugu√™s (Portuguese)</option>
    <option value="id">Bahasa Indonesia (Indonesian)</option>
    <option value="ur">ÿßÿ±ÿØŸà (Urdu)</option>
    <option value="de">Deutsch (German)</option>
    <option value="ja">Êó•Êú¨Ë™û (Japanese)</option>
  </select>
  <button id="saveSettingsBtn">Save</button>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const WEATHER_API_KEY = "e110e528cbca47f7ac3104351251407";

  // Translations dictionary for UI text
  const translations = {
    en: {
      title: "MapMyWeather",
      subtitle: "Explore real-time weather worldwide or search any city below",
      searchPlaceholder: "Search a city (e.g. London)",
      searchButton: "Search",
      gameButton: "üéÆ Play WeatherGuessr",
      settingsBtn: "Settings ‚öôÔ∏è",
      citiesWeatherTitle: "Global Cities Weather",
      favoritesTitle: "Your Favorite Locations",
      addFavoritePlaceholder: "Add a city to favorites",
      addFavoriteBtn: "Add to Favorites",
      aboutTitle: "About MapMyWeather",
      aboutText: "MapMyWeather is an interactive world map showing current weather conditions for major global cities. Click on any marker to learn more about the weather there, or use the search bar to view a detailed forecast. This app is powered by WeatherAPI.com and is entirely free to use.",
      noFavorites: "No favorite locations yet.",
      removeFavTitle: "Remove from favorites",
      settingsLabel: "Select Language",
      saveBtn: "Save",
      humidity: "Humidity",
      wind: "Wind",
      feelsLike: "Feels like",
      lastUpdated: "Updated"
    },
    pt: {
      title: "MapMeuTempo",
      subtitle: "Explore o clima em tempo real mundialmente ou pesquise qualquer cidade abaixo",
      searchPlaceholder: "Pesquise uma cidade (ex: Londres)",
      searchButton: "Pesquisar",
      gameButton: "üéÆ Jogar WeatherGuessr",
      settingsBtn: "Configura√ß√µes ‚öôÔ∏è",
      citiesWeatherTitle: "Clima das Cidades Globais",
      favoritesTitle: "Seus locais favoritos",
      addFavoritePlaceholder: "Adicione uma cidade aos favoritos",
      addFavoriteBtn: "Adicionar aos favoritos",
      aboutTitle: "Sobre o MapMeuTempo",
      aboutText: "MapMeuTempo √© um mapa interativo mundial que mostra condi√ß√µes clim√°ticas atuais para as principais cidades globais. Clique em qualquer marcador para saber mais sobre o clima, ou use a barra de pesquisa para ver a previs√£o detalhada. Este app √© alimentado pelo WeatherAPI.com e √© totalmente gratuito.",
      noFavorites: "Nenhum local favorito ainda.",
      removeFavTitle: "Remover dos favoritos",
      settingsLabel: "Selecione o idioma",
      saveBtn: "Salvar",
      humidity: "Umidade",
      wind: "Vento",
      feelsLike: "Sensa√ß√£o",
      lastUpdated: "Atualizado"
    },
    es: {
      title: "MapaMiClima",
      subtitle: "Explore el clima en tiempo real en todo el mundo o busque cualquier ciudad a continuaci√≥n",
      searchPlaceholder: "Buscar una ciudad (ej: Londres)",
      searchButton: "Buscar",
      gameButton: "üéÆ Jugar WeatherGuessr",
      settingsBtn: "Configuraci√≥n ‚öôÔ∏è",
      citiesWeatherTitle: "Clima de Ciudades Globales",
      favoritesTitle: "Tus ubicaciones favoritas",
      addFavoritePlaceholder: "Agregar una ciudad a favoritos",
      addFavoriteBtn: "Agregar a favoritos",
      aboutTitle: "Acerca de MapaMiClima",
      aboutText: "MapaMiClima es un mapa mundial interactivo que muestra las condiciones clim√°ticas actuales para las principales ciudades globales. Haga clic en cualquier marcador para obtener m√°s informaci√≥n sobre el clima all√≠, o use la barra de b√∫squeda para ver un pron√≥stico detallado. Esta aplicaci√≥n funciona con WeatherAPI.com y es completamente gratuita.",
      noFavorites: "A√∫n no hay ubicaciones favoritas.",
      removeFavTitle: "Eliminar de favoritos",
      settingsLabel: "Seleccionar idioma",
      saveBtn: "Guardar",
      humidity: "Humedad",
      wind: "Viento",
      feelsLike: "Sensaci√≥n t√©rmica",
      lastUpdated: "Actualizado"
    }
    // Other languages remain the same but shortened for brevity
  };

  // Detect or load language from localStorage
  let lang = localStorage.getItem("mapmyweather_language") || "en";

  // Set language UI texts
  function applyTranslations() {
    const t = translations[lang];
    document.getElementById("title").textContent = t.title;
    document.getElementById("subtitle").textContent = t.subtitle;
    document.getElementById("searchInput").placeholder = t.searchPlaceholder;
    document.getElementById("searchButton").textContent = t.searchButton;
    document.getElementById("gameButton").textContent = t.gameButton;
    document.getElementById("settingsBtn").textContent = t.settingsBtn;
    document.getElementById("citiesWeatherTitle").textContent = t.citiesWeatherTitle;
    document.getElementById("favoritesTitle").textContent = t.favoritesTitle;
    document.getElementById("addFavoriteInput").placeholder = t.addFavoritePlaceholder;
    document.getElementById("addFavoriteBtn").textContent = t.addFavoriteBtn;
    document.getElementById("aboutTitle").textContent = t.aboutTitle;
    document.getElementById("aboutText").textContent = t.aboutText;
    document.getElementById("settingsModalLabel").textContent = t.settingsLabel;
    document.getElementById("saveSettingsBtn").textContent = t.saveBtn;
  }

  applyTranslations();

  // Initialize map and cities
  const cities = [
    { name: "New York", coords: [40.7128, -74.0060] },
    { name: "London", coords: [51.5074, -0.1278] },
    { name: "Tokyo", coords: [35.6762, 139.6503] },
    { name: "Sydney", coords: [-33.8688, 151.2093] },
    { name: "Singapore", coords: [1.3521, 103.8198] },
    { name: "Paris", coords: [48.8566, 2.3522] },
    { name: "Dubai", coords: [25.276987, 55.296249] },
    { name: "Toronto", coords: [43.65107, -79.347015] },
    { name: "Rio de Janeiro", coords: [-22.9068, -43.1729] },
    { name: "Cape Town", coords: [-33.9249, 18.4241] },
    { name: "Moscow", coords: [55.7558, 37.6173] },
    { name: "Istanbul", coords: [41.0082, 28.9784] }
  ];

  const map = L.map("map").setView([20, 0], 2);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 18,
    attribution: "¬© OpenStreetMap contributors"
  }).addTo(map);

  // Create simple markers instead of banners to avoid overlapping
  cities.forEach(city => {
    const marker = L.marker(city.coords).addTo(map);
    
    // Fetch weather for popup
    fetch(`https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${encodeURIComponent(city.name)}`)
      .then(res => res.json())
      .then(data => {
        const t = translations[lang];
        marker.bindPopup(`
          <div style="text-align: center; min-width: 150px;">
            <h3 style="margin: 0 0 8px 0;">${data.location.name}</h3>
            <div style="font-size: 1.5rem; font-weight: bold; color: #4a90e2; margin: 8px 0;">
              ${Math.round(data.current.temp_c)}¬∞C
            </div>
            <div style="font-style: italic; color: #666; margin: 4px 0;">
              ${data.current.condition.text}
            </div>
            <div style="font-size: 0.85rem; color: #888;">
              ${t.feelsLike}: ${Math.round(data.current.feelslike_c)}¬∞C
            </div>
            <div style="font-size: 0.8rem; color: #999; margin-top: 8px;">
              ${t.humidity}: ${data.current.humidity}% | ${t.wind}: ${data.current.wind_kph} km/h
            </div>
          </div>
        `);
      })
      .catch(err => {
        marker.bindPopup(`<strong>${city.name}</strong><br>Weather data unavailable`);
      });

    marker.on("click", () => {
      window.location.href = `weather.html?city=${encodeURIComponent(city.name)}`;
    });
  });

  // Render cities weather cards
  function renderCitiesWeather() {
    const container = document.getElementById("citiesWeatherContainer");
    container.innerHTML = "";
    const t = translations[lang];

    cities.forEach(city => {
      const div = document.createElement("div");
      div.className = "city-weather";
      div.title = `View detailed weather for ${city.name}`;
      div.tabIndex = 0;
      div.setAttribute("role", "button");

      div.addEventListener("click", () => {
        window.location.href = `weather.html?city=${encodeURIComponent(city.name)}`;
      });
      div.addEventListener("keypress", e => {
        if (e.key === "Enter") {
          window.location.href = `weather.html?city=${encodeURIComponent(city.name)}`;
        }
      });

      // Fetch weather for each city
      fetch(`https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${encodeURIComponent(city.name)}`)
        .then(res => {
          if (!res.ok) throw new Error("Weather not found");
          return res.json();
        })
        .then(data => {
          const updateTime = new Date(data.current.last_updated).toLocaleTimeString();
          div.innerHTML = `
            <h3>${data.location.name}</h3>
            <div class="temp">${Math.round(data.current.temp_c)}¬∞C</div>
            <div class="desc">${data.current.condition.text}</div>
            <div class="details">
              <span>${t.humidity}: ${data.current.humidity}%</span>
              <span>${t.wind}: ${data.current.wind_kph} km/h</span>
            </div>
            <div style="font-size: 0.7rem; color: #999; margin-top: 8px;">
              ${t.lastUpdated}: ${updateTime}
            </div>
          `;
          container.appendChild(div);
        })
        .catch(() => {
          div.innerHTML = `
            <h3>${city.name}</h3>
            <p>‚ùå Weather data unavailable</p>
          `;
          container.appendChild(div);
        });
    });
  }

  // Favorites management
  function getFavorites() {
    return JSON.parse(localStorage.getItem("mapmyweather_favorites") || "[]");
  }

  function saveFavorites(favorites) {
    localStorage.setItem("mapmyweather_favorites", JSON.stringify(favorites));
  }

  function addFavorite(city) {
    const favorites = getFavorites();
    if (!favorites.includes(city)) {
      favorites.push(city);
      saveFavorites(favorites);
      renderFavorites();
    }
  }

  function removeFavorite(city) {
    let favorites = getFavorites();
    favorites = favorites.filter(c => c.toLowerCase() !== city.toLowerCase());
    saveFavorites(favorites);
    renderFavorites();
  }

  // Render favorite cities weather
  function renderFavorites() {
    const container = document.getElementById("favoritesContainer");
    container.innerHTML = "";
    const favorites = getFavorites();
    const t = translations[lang];

    if (favorites.length === 0) {
      const noFav = document.createElement("p");
      noFav.textContent = t.noFavorites;
      container.appendChild(noFav);
      return;
    }

    favorites.forEach(city => {
      const div = document.createElement("div");
      div.className = "city-weather";
      div.title = city;
      div.tabIndex = 0;
      div.setAttribute("role", "button");
      div.setAttribute("aria-label", `${city}, ${t.removeFavTitle}`);

      div.addEventListener("click", () => {
        window.location.href = `weather.html?city=${encodeURIComponent(city)}`;
      });
      div.addEventListener("keypress", e => {
        if (e.key === "Enter") {
          window.location.href = `weather.html?city=${encodeURIComponent(city)}`;
        }
      });

      // Fetch weather for each favorite city
      fetch(`https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${encodeURIComponent(city)}`)
        .then(res => {
          if (!res.ok) throw new Error("Weather not found");
          return res.json();
        })
        .then(data => {
          div.innerHTML = `
            <h3>${data.location.name}</h3>
            <div class="temp">${Math.round(data.current.temp_c)}¬∞C</div>
            <div class="desc">${data.current.condition.text}</div>
            <div class="details">
              <span>${t.humidity}: ${data.current.humidity}%</span>
              <span>${t.wind}: ${data.current.wind_kph} km/h</span>
            </div>
            <button class="remove-fav-btn" title="${t.removeFavTitle}" aria-label="${t.removeFavTitle}">‚úñ</button>
          `;
          container.appendChild(div);

          div.querySelector(".remove-fav-btn").addEventListener("click", e => {
            e.stopPropagation();
            removeFavorite(city);
          });
        })
        .catch(() => {
          div.innerHTML = `
            <h3>${city}</h3>
            <p>‚ùå Weather data unavailable</p>
            <button class="remove-fav-btn" title="${t.removeFavTitle}" aria-label="${t.removeFavTitle}">‚úñ</button>
          `;
          container.appendChild(div);

          div.querySelector(".remove-fav-btn").addEventListener("click", e => {
            e.stopPropagation();
            removeFavorite(city);
          });
        });
    });
  }

  // Initial renders
  renderCitiesWeather();
  renderFavorites();

  // Handle add favorite form submit
  document.getElementById("addFavoriteForm").addEventListener("submit", e => {
    e.preventDefault();
    const input = document.getElementById("addFavoriteInput");
    const cityName = input.value.trim();
    if (cityName) {
      addFavorite(cityName);
      input.value = "";
    }
  });

  // Handle search form submit (redirect to weather page)
  document.getElementById("searchForm").addEventListener("submit", e => {
    e.preventDefault();
    const city = document.getElementById("searchInput").value.trim();
    if (city) {
      window.location.href = `weather.html?city=${encodeURIComponent(city)}`;
    }
  });

  // Settings modal toggling
  const settingsBtn = document.getElementById("settingsBtn");
  const settingsModal = document.getElementById("settingsModal");
  const languageSelect = document.getElementById("languageSelect");
  const saveSettingsBtn = document.getElementById("saveSettingsBtn");

  // Initialize select with current lang
  languageSelect.value = lang;

  settingsBtn.addEventListener("click", () => {
    settingsModal.classList.toggle("show");
    languageSelect.focus();
  });

  // Close modal if click outside or Escape pressed
  window.addEventListener("click", e => {
    if (settingsModal.classList.contains("show") && !settingsModal.contains(e.target) && e.target !== settingsBtn) {
      settingsModal.classList.remove("show");
    }
  });

  window.addEventListener("keydown", e => {
    if (e.key === "Escape" && settingsModal.classList.contains("show")) {
      settingsModal.classList.remove("show");
    }
  });

  // Save settings and reload UI text
  saveSettingsBtn.addEventListener("click", () => {
    lang = languageSelect.value;
    localStorage.setItem("mapmyweather_language", lang);
    applyTranslations();
    renderCitiesWeather();
    renderFavorites();
    settingsModal.classList.remove("show");
  });
</script>

</body>
</html>
