<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MapMyWeather - Interactive Weather Map</title>
  <meta name="description" content="MapMyWeather is a free interactive map that shows live weather for major cities and lets you search any city for a forecast. Powered by WeatherAPI.com." />
  <meta name="keywords" content="weather, forecast, weather map, weather tracker, world map, free weather, interactive weather, city weather, global weather" />
  <meta name="author" content="Reuben" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(to right, #74ebd5, #ACB6E5);
      color: #222;
    }

    header {
      padding: 1rem 2rem;
      background: rgba(255, 255, 255, 0.85);
      text-align: center;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    header h1 {
      margin: 0;
      font-size: 2rem;
    }

    header p {
      margin: 0.5rem 0 1rem;
      font-size: 1.1rem;
    }

    #searchForm {
      max-width: 400px;
      margin: 0 auto;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    #searchInput {
      flex-grow: 1;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 24px;
      font-size: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      min-width: 200px;
    }

    #searchButton {
      padding: 0.6rem 1.2rem;
      background-color: #4a90e2;
      border: none;
      border-radius: 24px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
      min-width: 100px;
    }

    #searchButton:hover {
      background-color: #357ABD;
    }

    #gameButton {
      padding: 0.6rem 1.2rem;
      background-color: #ff7043;
      border: none;
      border-radius: 24px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
      min-width: 180px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }

    #gameButton:hover {
      background-color: #e64a19;
    }

    main {
      max-width: 1000px;
      margin: 1rem auto;
      padding: 0 1rem;
    }

    #map {
      height: 450px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    #weatherContainer, #favoritesContainer {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
      justify-content: center;
    }

    .city-weather {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 1rem;
      width: 200px;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
      position: relative;
    }

    .city-weather:hover {
      transform: scale(1.03);
    }

    .city-weather h3 {
      margin-top: 0;
    }

    .temp {
      font-size: 1.5rem;
      font-weight: bold;
    }

    .desc {
      font-style: italic;
      color: #444;
    }

    button.fav-btn, button.remove-fav-btn {
      margin-top: 0.8rem;
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.3s ease;
    }

    button.fav-btn {
      background-color: #f0ad4e;
      color: white;
    }

    button.fav-btn:hover {
      background-color: #ec971f;
    }

    button.remove-fav-btn {
      background-color: #d9534f;
      color: white;
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      font-size: 16px;
      line-height: 24px;
      padding: 0;
      border-radius: 50%;
    }

    button.remove-fav-btn:hover {
      background-color: #c9302c;
    }

    #about {
      margin-top: 2rem;
      background: rgba(255, 255, 255, 0.9);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
      color: #444;
    }

    #feedbackBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #4a90e2;
      color: white;
      padding: 0.7rem 1.2rem;
      border: none;
      border-radius: 999px;
      font-weight: bold;
      cursor: pointer;
      font-size: 0.95rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      transition: background-color 0.3s ease;
      z-index: 9999;
      text-decoration: none;
    }

    #feedbackBtn:hover {
      background-color: #357ABD;
    }

    @media (max-width: 600px) {
      #weatherContainer, #favoritesContainer {
        flex-direction: column;
        align-items: center;
      }
      #searchForm {
        flex-direction: column;
        gap: 0.5rem;
      }
      #searchInput, #searchButton, #gameButton {
        min-width: 100%;
        border-radius: 24px;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>MapMyWeather</h1>
  <p>Explore real-time weather worldwide or search any city below</p>
  <form id="searchForm">
    <input type="search" id="searchInput" placeholder="Search a city (e.g. London)" required />
    <button type="submit" id="searchButton">Search</button>
    <button type="button" id="gameButton" onclick="location.href='game.html'">ðŸŽ® Play WeatherGuessr</button>
  </form>
</header>

<main>
  <div id="map"></div>
  <div id="weatherContainer"></div>

  <section id="favoritesSection" style="margin-top: 2rem;">
    <h2>Your Favorite Locations</h2>
    <div id="favoritesContainer">
      <!-- Favorite cities weather cards will be rendered here -->
    </div>
  </section>

  <section id="about">
    <h2>About MapMyWeather</h2>
    <p>
      MapMyWeather is an interactive world map showing current weather conditions for major global cities.
      Click on any marker to learn more about the weather there, or use the search bar to view a detailed forecast.
      This app is powered by <strong>WeatherAPI.com</strong> and is entirely free to use.
    </p>
  </section>
</main>

<footer>
  Â© 2025 MapMyWeather | Built by Reuben | Data from WeatherAPI.com
</footer>

<!-- Feedback Button -->
<a id="feedbackBtn" href="https://docs.google.com/forms/d/1Sr-6EWcdBa7Hst9nyJLvTz7oU-eGozoYBpZTMKj7_mU/viewform" target="_blank">
  Help Us Improve
</a>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const WEATHER_API_KEY = "e110e528cbca47f7ac3104351251407";

  // List of cities to display markers and fetch weather
  const cities = [
    { name: "New York", coords: [40.7128, -74.0060] },
    { name: "London", coords: [51.5074, -0.1278] },
    { name: "Tokyo", coords: [35.6762, 139.6503] },
    { name: "Sydney", coords: [-33.8688, 151.2093] },
    { name: "Singapore", coords: [1.3521, 103.8198] },
    { name: "Paris", coords: [48.8566, 2.3522] },
    { name: "Dubai", coords: [25.276987, 55.296249] },
    { name: "Toronto", coords: [43.65107, -79.347015] },
    { name: "Rio de Janeiro", coords: [-22.9068, -43.1729] },
    { name: "Cape Town", coords: [-33.9249, 18.4241] },
    { name: "Moscow", coords: [55.7558, 37.6173] },
    { name: "Istanbul", coords: [41.0082, 28.9784] }
  ];

  // Initialize map
  const map = L.map("map").setView([20, 0], 2);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 18,
    attribution: "Â© OpenStreetMap contributors"
  }).addTo(map);

  // Add markers and fetch weather for each city
  cities.forEach(city => {
    const marker = L.marker(city.coords).addTo(map);
    marker.bindPopup(city.name);
    fetchWeather(city.name);
  });

  // Fetch current weather for city and display on page
  function fetchWeather(cityName) {
    const url = `https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${encodeURIComponent(cityName)}`;
    fetch(url)
      .then(response => {
        if (!response.ok) throw new Error("Weather not found");
        return response.json();
      })
      .then(data => displayWeather(data))
      .catch(err => console.error(`Error loading weather for ${cityName}:`, err));
  }

  // LOCAL STORAGE FAVORITES SYSTEM
  const FAVORITES_KEY = "mapmyweather_favorites";

  function getFavorites() {
    const favs = localStorage.getItem(FAVORITES_KEY);
    return favs ? JSON.parse(favs) : [];
  }

  function saveFavorites(favorites) {
    localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
  }

  function addFavorite(cityName) {
    const favorites = getFavorites();
    if (!favorites.includes(cityName)) {
      favorites.push(cityName);
      saveFavorites(favorites);
      renderFavorites();
    }
  }

  function removeFavorite(cityName) {
    let favorites = getFavorites();
    favorites = favorites.filter(c => c !== cityName);
    saveFavorites(favorites);
    renderFavorites();
  }

  // Render favorites section with weather cards
  function renderFavorites() {
    const container = document.getElementById("favoritesContainer");
    container.innerHTML = "";

    const favorites = getFavorites();
    if (favorites.length === 0) {
      container.innerHTML = "<p>No favorite locations yet.</p>";
      return;
    }

    favorites.forEach(city => {
      const favDiv = document.createElement("div");
      favDiv.className = "city-weather favorite-city";
      favDiv.style.cursor = "pointer";
      favDiv.title = "Click to view detailed forecast";

      favDiv.addEventListener("click", () => {
        window.location.href = `weather.html?city=${encodeURIComponent(city)}`;
      });

      fetch(`https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${encodeURIComponent(city)}`)
        .then(res => {
          if (!res.ok) throw new Error("Weather not found");
          return res.json();
        })
        .then(data => {
          favDiv.innerHTML = `
            <h3>${data.location.name}</h3>
            <div class="temp">${Math.round(data.current.temp_c)}Â°C</div>
            <div class="desc">${data.current.condition.text}</div>
            <div>Humidity: ${data.current.humidity}%</div>
            <div>Wind: ${Math.round(data.current.wind_kph)} km/h</div>
            <button class="remove-fav-btn" title="Remove from favorites">âœ–</button>
          `;
          container.appendChild(favDiv);

          favDiv.querySelector(".remove-fav-btn").addEventListener("click", e => {
            e.stopPropagation();
            removeFavorite(city);
          });
        })
        .catch(err => {
          console.error(`Failed to load favorite weather for ${city}`, err);
          favDiv.textContent = `Failed to load ${city}`;
          container.appendChild(favDiv);
        });
    });
  }

  // Updated displayWeather to add favorite button
  function displayWeather(data) {
    const container = document.getElementById("weatherContainer");

    const cityName = data.location.name;
    const favorites = getFavorites();
    const isFavorited = favorites.includes(cityName);

    const div = document.createElement("div");
    div.className = "city-weather";
    div.innerHTML = `
      <h3>${cityName}</h3>
      <div class="temp">${Math.round(data.current.temp_c)}Â°C</div>
      <div class="desc">${data.current.condition.text}</div>
      <div>Humidity: ${data.current.humidity}%</div>
      <div>Wind: ${Math.round(data.current.wind_kph)} km/h</div>
      <button class="fav-btn">${isFavorited ? "â˜… Remove Favorite" : "â˜† Add Favorite"}</button>
    `;

    container.appendChild(div);

    const favBtn = div.querySelector(".fav-btn");
    favBtn.addEventListener("click", () => {
      if (getFavorites().includes(cityName)) {
        removeFavorite(cityName);
        favBtn.textContent = "â˜† Add Favorite";
      } else {
        addFavorite(cityName);
        favBtn.textContent = "â˜… Remove Favorite";
      }
    });
  }

  // Search form handler
  document.getElementById("searchForm").addEventListener("submit", e => {
    e.preventDefault();
    const city = document.getElementById("searchInput").value.trim();
    if (city) {
      window.location.href = `weather.html?city=${encodeURIComponent(city)}`;
    }
  });

  // Render favorites on page load
  renderFavorites();

</script>

</body>
</html>
